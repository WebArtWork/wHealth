import{a as P}from"./chunk-5HTQFLT5.js";import{a as M}from"./chunk-L5QHBTWI.js";import{e as b}from"./chunk-WDW6KDBE.js";import{K as c,L as p,M as _,Qa as g,R as u,Wa as y,X as f,bb as v,f as h,hb as w,i as a,ob as k,s as m,vb as C,xb as S}from"./chunk-STQM5VJK.js";var n=(()=>{class r{constructor(i,s,e,o,l,j){this._translate=i,this._healthplaceService=s,this._alert=e,this._form=o,this._core=l,this._route=j,this.columns=["name","description","address","latitude","longitude","placeType"],this.form=this._form.getForm("healthplace",P),this.config={paginate:this.setRows.bind(this),perPage:20,setPerPage:this._healthplaceService.setPerPage.bind(this._healthplaceService),allDocs:!1,create:()=>{this._form.modal(this.form,{label:"Create",click:(t,d)=>h(this,null,function*(){d(),this._preCreate(t),yield a(this._healthplaceService.create(t)),this.setRows()})})},update:t=>{this._form.modal(this.form,[],t).then(d=>{this._core.copy(d,t),this._healthplaceService.update(t)})},delete:t=>{this._alert.question({text:this._translate.translate("Common.Are you sure you want to delete this healthplace?"),buttons:[{text:this._translate.translate("Common.No")},{text:this._translate.translate("Common.Yes"),callback:()=>h(this,null,function*(){yield a(this._healthplaceService.delete(t)),this.setRows()})}]})},buttons:[{icon:"comment",hrefFunc:t=>"/comments/"+t.clinic+"/places/"+t._id},{icon:"store",hrefFunc:t=>"/trade/"+t._id},{icon:"cloud_download",click:t=>{this._form.modalUnique("healthplace","url",t)}}],headerButtons:[{icon:"playlist_add",click:this._bulkManagement(),class:"playlist"},{icon:"edit_note",click:this._bulkManagement(!1),class:"edit"}]},this.rows=[],this.clinic_id="",this.pharmacy_id="",this.drug_id="",this.link_id="",this._page=1,this._route.paramMap.subscribe(t=>{this.clinic_id=t.get("clinic_id")||"",this.pharmacy_id=t.get("pharmacy_id")||"",this.drug_id=t.get("drug_id")||"",this.link_id=t.get("link_id")||""}),this.setRows()}setRows(i=this._page){this._page=i,this._core.afterWhile(this,()=>{this._healthplaceService.get({page:i,query:this._query()}).subscribe(s=>{this.rows.splice(0,this.rows.length),this.rows.push(...s)})},250)}_bulkManagement(i=!0){return()=>{this._form.modalDocs(i?[]:this.rows).then(s=>h(this,null,function*(){if(i)for(let e of s)this._preCreate(e),yield a(this._healthplaceService.create(e));else{for(let e of this.rows)s.find(o=>o._id===e._id)||(yield a(this._healthplaceService.delete(e)));for(let e of s){let o=this.rows.find(l=>l._id===e._id);o?(this._core.copy(e,o),yield a(this._healthplaceService.update(o))):(this._preCreate(e),yield a(this._healthplaceService.create(e)))}}this.setRows()}))}}_preCreate(i){delete i.__created,this.clinic_id&&(i.clinic=this.clinic_id),this.pharmacy_id&&(i.pharmacy=this.pharmacy_id),this.drug_id&&(i.drug=this.drug_id),this.link_id&&(i.link=this.link_id)}_query(){let i="";return this.clinic_id&&(i+=(i?"&":"")+"clinic="+this.clinic_id),this.pharmacy_id&&(i+=(i?"&":"")+"pharmacy="+this.pharmacy_id),this.drug_id&&(i+=(i?"&":"")+"drug="+this.drug_id),this.link_id&&(i+=(i?"&":"")+"link="+this.link_id),i}static{this.\u0275fac=function(s){return new(s||r)(c(k),c(M),c(w),c(S),c(v),c(g))}}static{this.\u0275cmp=p({type:r,selectors:[["ng-component"]],standalone:!1,decls:1,vars:3,consts:[["title","Places",3,"columns","config","rows"]],template:function(s,e){s&1&&f(0,"wtable",0),s&2&&u("columns",e.columns)("config",e.config)("rows",e.rows)},dependencies:[C],encapsulation:2})}}return r})();var R=[{path:"",component:n},{path:"clinics/:clinic_id",component:n},{path:"pharmacies/:pharmacy_id",component:n},{path:"drugs/:drug_id",component:n},{path:"links/:link_id",component:n}],z=(()=>{class r{static{this.\u0275fac=function(s){return new(s||r)}}static{this.\u0275mod=_({type:r})}static{this.\u0275inj=m({imports:[y.forChild(R),b]})}}return r})();export{z as PlacesModule};
